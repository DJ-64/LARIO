<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LARIO</title>
<style>
  body {
    margin: 0;
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    background: skyblue;
    border: 4px solid black;
  }
</style>
</head>
<body>

<canvas id="game" width="800" height="400"></canvas>


<script>
  const camera = {
  x: 0,
  y: 0
};

const WORLD_WIDTH = 1800;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let score = 0;
let inHappyHour = false;
function getRandomInt(min, max) {
return Math.floor(Math.random() * (max - min + 1)) + min;
}
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
const player = {
  x: 50,
  y: 300,
  w: 40,
  h: 40,
  vx: 0,
  vy: 0,
  speed: 4,
  jumpPower: 14,
  onGround: false
};


const gravity = 0.7;
const storm = {
    x: 1800,
    y: 0,
    w: 10,
    h: 1800,
};
let platforms = [
  { x: 0,   y: 360, w: 1800, h: 40, moveable: false },
  { x: 200, y: 280, w: 120, h: 20, moveable: true },
  { x: 400, y: 200, w: 120, h: 20, moveable: true },
  { x: 600, y: 280, w: 120, h: 20, moveable: true},
  { x: 800, y: 280, w: 120, h: 20, moveable: true},
  { x: 1000, y: 280, w: 120, h: 20, moveable: true},
];
let coins = [
    {x:250, y:310, w:20, h:20},
    {x:800, y:310, w:20, h:20},
    {x:900, y:310, w:20, h:20},
    {x:1000, y:310, w:20, h:20},
    {x:550, y:200, w:20, h:20},
];
function restartcoins() {
    coins = [
        {x:350, y:200, w:20, h:20},
    {x:450, y:310, w:20, h:20},
    {x:250, y:310, w:20, h:20},
    {x:650, y:310, w:20, h:20},
    {x:550, y:200, w:20, h:20},
    ]
}
const flag = { x: 1580, y: 280, w: 20, h: 80 };


const keys = {};
addEventListener("keydown", e => keys[e.code] = true);
addEventListener("keyup", e => keys[e.code] = false);



function collide(a, b) {
  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    a.y < b.y + b.h &&
    a.y + a.h > b.y
  );
}


function update() {

  player.vx = 0;
  if (keys["ArrowLeft"] || keys["KeyA"]) player.vx = -player.speed;
  if (keys["ArrowRight"] || keys["KeyD"]) player.vx = player.speed;


  if ((keys["Space"] || keys["KeyW"]) && player.onGround) {
    player.vy = -player.jumpPower;
    player.onGround = false;
  }

  player.vy += gravity;


  player.x += player.vx;
  player.y += player.vy;
  // Camera follows player horizontally
camera.x = player.x - canvas.width / 2;

// Clamp camera to world bounds
camera.x = Math.max(0, Math.min(camera.x, WORLD_WIDTH - canvas.width));

  player.onGround = false;
  platforms.forEach(p => {
    if (collide(player, p) && player.vy > 0) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  coins.forEach(coin => {
  if (collide(player, coin)) {
    coin.x = -1000;
    coin.y = -1000;
    score = score + 50;
  }
    });

    if (inHappyHour) return; 
  if (collide(player, flag)) {
    score = score + 100;
    happyhour();
  }
}

async function happyhour() {
  inHappyHour = true;
  await sleep(1500);
  for (let i = 0; i < 490; i++) {
    await sleep(16);
    storm.x -= 3;

    if (collide(player, storm)) {
      storm.x = 1800;
      player.x = 50;
      player.y = 300;
      restartcoins();
      inHappyHour = false;
      alert(`Level failed.\nDont get caught in the wall!`);
      return;
    }
  }

  storm.x = 1800;
  player.x = 50;
  player.y = 300;

  for (let plat of platforms) {
    if (plat.moveable) {
      plat.y = getRandomInt(190, 300);
    }
  }
  score += 100;
alert(`Level Passed!\nScore: ${score}`);
  restartcoins();
  inHappyHour = false;
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);


  ctx.fillStyle = "red";
  ctx.fillRect(player.x - camera.x, player.y, player.w, player.h);


  ctx.fillStyle = "green";
  platforms.forEach(p =>
    ctx.fillRect(p.x - camera.x, p.y, p.w, p.h)
  );

  ctx.fillStyle = "gold";
  coins.forEach(p =>
    ctx.fillRect(p.x - camera.x, p.y, 20, 20)
  );

  ctx.fillStyle = "gold";
  ctx.fillRect(flag.x - camera.x, flag.y, flag.w, flag.h);

  ctx.fillStyle = "orange";
  ctx.fillRect(storm.x - camera.x, storm.y, flag.w, storm.h);
}

// ---------- GAME LOOP ----------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>